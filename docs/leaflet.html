<!DOCTYPE html>
<html lang="en">
<head>
    <title>Slippi SA Ranked Map</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
    </style>
</head>
<body>
    <style>
        .leaflet-popup-content {
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        }
    </style>

    <div id="map"></div>

    <script>
        // Inicialização do mapa Leaflet
        const map = L.map('map').setView([-15.79, -47.88], 2); // Posição inicial (Brasília, DF)

        // Adiciona o provedor OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        // Carregar dados do GeoServer (GeoJSON)

            //camada do detran, para debug: https://geoservicos.detran.df.gov.br/geoserver/Detran/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=Detran:acidente_transito_2023&maxFeatures=5000000&outputFormat=application%2Fjson
            //camada de pontos do geoserver: http://localhost:8081/geoserver/melee/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=melee%3Aoutput_centroids&outputFormat=application%2Fjson
           

        fetch('http://localhost:8081/geoserver/melee/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=melee:output_centroids&maxFeatures=5000000&outputFormat=application%2Fjson')
            .then(response => response.json())
            .then(data => {
                // Adiciona a camada GeoJSON com os dados
                L.geoJSON(data, {
                    onEachFeature: function (feature, layer) {
                        // Exibe um popup quando o ponto é clicado
                        layer.bindPopup(`<strong>Country:</strong> ${feature.properties.country}<br><strong>Rank:</strong> ${feature.properties.most_common_rank}`);
                    },
                    pointToLayer: function (feature, latlng) {
                        // Define o estilo para os círculos (centroides)
                        return L.circleMarker(latlng, {
                            radius: 6,
                            fillColor: '#FF4500',
                            color: '#FFFFFF',
                            weight: 1,
                            opacity: 1,
                            fillOpacity: 0.8
                        });
                    }
                }).addTo(map);
            });

        // Altera o cursor ao passar sobre os pontos
        map.on('mouseover', function(e) {
            map.getContainer().style.cursor = 'pointer';
        });
        
        map.on('mouseout', function(e) {
            map.getContainer().style.cursor = '';
        });
    </script>
</body>
</html>
